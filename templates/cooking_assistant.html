{% extends "base.html" %}

{% block title %}Asistente de Cocina - Sistema Experto Culinario{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                <div class="card-body text-center py-5">
                    <h1 class="display-5 fw-bold mb-3">
                        <i class="fas fa-robot me-3"></i>
                        Asistente de Cocina Inteligente
                    </h1>
                    <p class="lead mb-0">
                        Tu chef personal con inteligencia artificial est√° aqu√≠ para ayudarte
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Chat Principal -->
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar bg-white text-success rounded-circle d-flex align-items-center justify-content-center" 
                                 style="width: 40px; height: 40px;">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0">Chef AI Assistant</h5>
                            <small class="opacity-75">
                                <span class="status-indicator"></span> En l√≠nea
                            </small>
                        </div>
                        <div class="flex-shrink-0">
                            <button class="btn btn-outline-light btn-sm" onclick="clearChat()">
                                <i class="fas fa-broom"></i> Limpiar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- √Årea de chat -->
                <div class="card-body d-flex flex-column" style="height: 500px;">
                    <div id="chat-messages" class="flex-grow-1 overflow-auto mb-3">
                        <!-- Mensaje de bienvenida -->
                        <div class="message bot-message">
                            <div class="d-flex mb-3">
                                <div class="flex-shrink-0">
                                    <div class="avatar bg-success text-white rounded-circle d-flex align-items-center justify-content-center" 
                                         style="width: 35px; height: 35px;">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="bg-light rounded p-3">
                                        <p class="mb-2">¬°Hola! Soy tu asistente culinario inteligente. üç≥</p>
                                        <p class="mb-0">Puedo ayudarte con:</p>
                                        <ul class="mb-0 mt-2">
                                            <li>Sugerencias de recetas</li>
                                            <li>Consejos de cocina</li>
                                            <li>Informaci√≥n nutricional</li>
                                            <li>Sustitutos de ingredientes</li>
                                            <li>T√©cnicas culinarias</li>
                                        </ul>
                                    </div>
                                    <small class="text-muted">Hace un momento</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input de mensaje -->
                    <div class="input-group">
                        <input type="text" 
                               id="message-input" 
                               class="form-control" 
                               placeholder="Escribe tu pregunta culinaria aqu√≠..."
                               onkeypress="handleKeyPress(event)">
                        <button class="btn btn-success" onclick="sendMessage()" id="send-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar con sugerencias -->
        <div class="col-lg-4">
            <!-- Sugerencias r√°pidas -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Preguntas Frecuentes
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øQu√© puedo cocinar con pollo y arroz?')">
                            üçó ¬øQu√© puedo cocinar con pollo y arroz?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øC√≥mo sustituir huevos en una receta vegana?')">
                            ü•ö ¬øC√≥mo sustituir huevos en recetas veganas?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øCu√°nto tiempo cocinar pasta al dente?')">
                            üçù ¬øCu√°nto tiempo cocinar pasta al dente?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øC√≥mo hacer que mi comida sea m√°s saludable?')">
                            ü•ó ¬øC√≥mo hacer comida m√°s saludable?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øQu√© especias van bien con el pollo?')">
                            üå∂Ô∏è ¬øQu√© especias van bien con el pollo?
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Consejos del d√≠a -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-day text-info me-2"></i>
                        Consejo del D√≠a
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <i class="fas fa-thermometer-half fa-2x text-warning mb-3"></i>
                        <h6>Temperatura Perfecta</h6>
                        <p class="small text-muted mb-0">
                            Para obtener el mejor sabor en carnes, usa un term√≥metro: 
                            pollo 75¬∞C, carne de res 60¬∞C para t√©rmino medio.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Recetas sugeridas -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-star text-warning me-2"></i>
                        Recetas Populares
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item border-0 px-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Pasta Carbonara</h6>
                                    <small class="text-muted">‚≠ê 4.8 ‚Ä¢ 25 min</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" 
                                        onclick="quickQuestion('¬øC√≥mo hacer pasta carbonara perfecta?')">
                                    Preguntar
                                </button>
                            </div>
                        </div>
                        <div class="list-group-item border-0 px-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Pollo al Curry</h6>
                                    <small class="text-muted">‚≠ê 4.6 ‚Ä¢ 35 min</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" 
                                        onclick="quickQuestion('¬øCu√°les son los secretos del curry?')">
                                    Preguntar
                                </button>
                            </div>
                        </div>
                        <div class="list-group-item border-0 px-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Ensalada C√©sar</h6>
                                    <small class="text-muted">‚≠ê 4.5 ‚Ä¢ 15 min</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" 
                                        onclick="quickQuestion('¬øC√≥mo hacer aderezo c√©sar casero?')">
                                    Preguntar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Estado del asistente -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        Sobre el Asistente
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center g-3">
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-brain fa-lg text-primary"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">IA Avanzada</small>
                                    <div class="small text-muted">Procesamiento NLP</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-database fa-lg text-success"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">1000+ Recetas</small>
                                    <div class="small text-muted">Base de datos</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-clock fa-lg text-warning"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">24/7</small>
                                    <div class="small text-muted">Disponible</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-language fa-lg text-info"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">Espa√±ol</small>
                                    <div class="small text-muted">Nativo</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="alert alert-info py-2 mb-0" role="alert">
                        <small>
                            <i class="fas fa-magic me-1"></i>
                            <strong>Tip:</strong> Puedes preguntarme sobre t√©cnicas culinarias, 
                            sustitutos de ingredientes, tiempos de cocci√≥n y mucho m√°s.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let messageCount = 0;
    
    // Enviar mensaje
    function sendMessage() {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        
        if (!message) return;
        
        // Agregar mensaje del usuario
        addMessage('user', message);
        
        // Limpiar input y deshabilitar bot√≥n
        input.value = '';
        setLoading(true);
        
        // Simular respuesta del bot (en producci√≥n ser√≠a una llamada AJAX)
        setTimeout(() => {
            const response = generateResponse(message);
            addMessage('bot', response);
            setLoading(false);
        }, 1000 + Math.random() * 2000);
    }
    
    // Agregar mensaje al chat
    function addMessage(sender, content) {
        const chatMessages = document.getElementById('chat-messages');
        const isBot = sender === 'bot';
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isBot ? 'bot-message' : 'user-message'}`;
        
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        if (isBot) {
            messageDiv.innerHTML = `
                <div class="d-flex mb-3">
                    <div class="flex-shrink-0">
                        <div class="avatar bg-success text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 35px; height: 35px;">
                            <i class="fas fa-robot"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="bg-light rounded p-3">
                            ${content}
                        </div>
                        <small class="text-muted">${time}</small>
                    </div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="d-flex mb-3 justify-content-end">
                    <div class="flex-grow-1 me-3 text-end">
                        <div class="bg-primary text-white rounded p-3">
                            ${content}
                        </div>
                        <small class="text-muted">${time}</small>
                    </div>
                    <div class="flex-shrink-0">
                        <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 35px; height: 35px;">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            `;
        }
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        messageCount++;
    }
    
    // Generar respuesta simulada del bot
    function generateResponse(message) {
        const msg = message.toLowerCase();
        
        // Respuestas predefinidas basadas en palabras clave
        if (msg.includes('pollo') && msg.includes('arroz')) {
            return `üçó ¬°Excelente combinaci√≥n! Te sugiero:<br><br>
                    <strong>Arroz con Pollo Cl√°sico:</strong><br>
                    ‚Ä¢ Sofr√≠e el pollo con ajo y cebolla<br>
                    ‚Ä¢ Agrega arroz y caldo de pollo<br>
                    ‚Ä¢ Cocina 18-20 minutos a fuego medio<br>
                    ‚Ä¢ A√±ade verduras para m√°s color y nutrici√≥n<br><br>
                    üí° <em>Tip:</em> Usa azafr√°n para dar color dorado y sabor especial.`;
        }
        
        if (msg.includes('huevo') && (msg.includes('vegano') || msg.includes('sustituir'))) {
            return `ü•ö‚û°Ô∏èüå± Sustitutos veganos para huevos:<br><br>
                    <strong>Para hornear:</strong><br>
                    ‚Ä¢ 1 tbsp linaza molida + 3 tbsp agua (reposar 5 min)<br>
                    ‚Ä¢ 1/4 taza aquafaba (l√≠quido de garbanzos)<br>
                    ‚Ä¢ 1/4 taza pur√© de manzana<br><br>
                    <strong>Para ligar:</strong><br>
                    ‚Ä¢ Harina de garbanzo + agua<br>
                    ‚Ä¢ Tofu suave desmenuzado<br><br>
                    ‚ú® <em>Cada sustituto tiene propiedades diferentes!</em>`;
        }
        
        if (msg.includes('pasta') && msg.includes('dente')) {
            return `üçù Pasta al dente perfecta:<br><br>
                    <strong>Regla general:</strong> Tiempo del paquete - 1 minuto<br><br>
                    <strong>Pasos:</strong><br>
                    1. Agua hirviendo con sal abundante<br>
                    2. Agregar pasta cuando burbujee fuerte<br>
                    3. Revolver ocasionalmente<br>
                    4. Probar 1-2 min antes del tiempo indicado<br>
                    5. Debe quedar firme al morder<br><br>
                    üßÇ <em>Tip:</em> El agua debe saber a "mar" de sal.`;
        }
        
        if (msg.includes('saludable') || msg.includes('salud')) {
            return `ü•ó Consejos para cocina saludable:<br><br>
                    <strong>T√©cnicas:</strong><br>
                    ‚Ä¢ Cocinar al vapor, hornear o plancha<br>
                    ‚Ä¢ Reducir sal, usar especias y hierbas<br>
                    ‚Ä¢ Incluir verduras de colores variados<br><br>
                    <strong>Ingredientes:</strong><br>
                    ‚Ä¢ Granos integrales en lugar de refinados<br>
                    ‚Ä¢ Prote√≠nas magras (pescado, pollo sin piel)<br>
                    ‚Ä¢ Grasas buenas (aceite oliva, aguacate)<br><br>
                    üíö <em>Recuerda:</em> Balance y variedad son clave.`;
        }
        
        if (msg.includes('especias') && msg.includes('pollo')) {
            return `üå∂Ô∏è Especias perfectas para pollo:<br><br>
                    <strong>Cl√°sicas:</strong><br>
                    ‚Ä¢ Piment√≥n, or√©gano, tomillo<br>
                    ‚Ä¢ Ajo en polvo, cebolla en polvo<br><br>
                    <strong>Internacionales:</strong><br>
                    ‚Ä¢ Curry (india) ‚Ä¢ Cinco especias (china)<br>
                    ‚Ä¢ Hierbas de Provenza (francesa)<br>
                    ‚Ä¢ Caj√∫n (estadounidense)<br><br>
                    <strong>Marinad b√°sico:</strong><br>
                    Aceite + lim√≥n + ajo + especias elegidas<br><br>
                    ‚è∞ <em>Marina al menos 30 minutos.</em>`;
        }
        
        if (msg.includes('carbonara')) {
            return `üçù Carbonara aut√©ntica italiana:<br><br>
                    <strong>Ingredientes (4 personas):</strong><br>
                    ‚Ä¢ 400g espagueti ‚Ä¢ 4 huevos (solo yemas)<br>
                    ‚Ä¢ 150g panceta ‚Ä¢ 100g queso Pecorino Romano<br>
                    ‚Ä¢ Pimienta negra reci√©n molida<br><br>
                    <strong>Secreto:</strong><br>
                    ‚ùå NO lleva nata ni ajo<br>
                    ‚úÖ El cremoso viene de los huevos y queso<br>
                    üî• Mezclar fuera del fuego para no cuajar<br><br>
                    üáÆüáπ <em>¬°Receta tradicional romana!</em>`;
        }
        
        if (msg.includes('curry')) {
            return `üçõ Secretos del curry perfecto:<br><br>
                    <strong>Base arom√°tica:</strong><br>
                    ‚Ä¢ Sofre√≠r cebolla hasta dorar<br>
                    ‚Ä¢ Agregar ajo y jengibre<br>
                    ‚Ä¢ Tostar especias 30 segundos<br><br>
                    <strong>Especias clave:</strong><br>
                    ‚Ä¢ C√∫rcuma, comino, cilantro molido<br>
                    ‚Ä¢ Garam masala, chile en polvo<br><br>
                    <strong>Tips:</strong><br>
                    ü•• Leche de coco al final<br>
                    üçÖ Tomate para acidez<br>
                    ‚è∞ Cocci√≥n lenta = m√°s sabor<br><br>
                    üå∂Ô∏è <em>Ajusta picante al gusto.</em>`;
        }
        
        if (msg.includes('aderezo') && msg.includes('c√©sar')) {
            return `ü•ó Aderezo C√©sar casero:<br><br>
                    <strong>Ingredientes:</strong><br>
                    ‚Ä¢ 2 yemas de huevo ‚Ä¢ 2 dientes ajo<br>
                    ‚Ä¢ 4 anchoas ‚Ä¢ Jugo 1 lim√≥n<br>
                    ‚Ä¢ 1/2 taza aceite oliva ‚Ä¢ Queso parmesano<br><br>
                    <strong>Preparaci√≥n:</strong><br>
                    1. Machacar ajo y anchoas<br>
                    2. Batir yemas con lim√≥n<br>
                    3. Agregar aceite lentamente<br>
                    4. Incorporar queso y sazonar<br><br>
                    üßÑ <em>El ajo crudo le da el toque aut√©ntico.</em>`;
        }
        
        // Respuesta gen√©rica si no hay coincidencias
        const genericResponses = [
            `ü§î Interesante pregunta sobre cocina. Te recomiendo ser m√°s espec√≠fico para darte una respuesta detallada. <br><br>¬øPodr√≠as contarme m√°s detalles? Por ejemplo:<br>‚Ä¢ ¬øQu√© ingredientes tienes?<br>‚Ä¢ ¬øQu√© tipo de cocina prefieres?<br>‚Ä¢ ¬øTienes alguna restricci√≥n diet√©tica?`,
            
            `üë®‚Äçüç≥ Como chef virtual, necesito m√°s informaci√≥n para ayudarte mejor. <br><br>Puedo asistirte con:<br>‚Ä¢ Recetas espec√≠ficas<br>‚Ä¢ T√©cnicas de cocina<br>‚Ä¢ Sustitutos de ingredientes<br>‚Ä¢ Informaci√≥n nutricional<br><br>¬øSobre cu√°l te gustar√≠a saber?`,
            
            `üç≥ ¬°Me encanta hablar de cocina! Para darte la mejor respuesta, comparte conmigo:<br><br>‚Ä¢ ¬øEs sobre una receta espec√≠fica?<br>‚Ä¢ ¬øNecesitas consejos de t√©cnica?<br>‚Ä¢ ¬øBuscas opciones saludables?<br>‚Ä¢ ¬øTienes ingredientes espec√≠ficos?<br><br>¬°Estoy aqu√≠ para ayudarte!`
        ];
        
        return genericResponses[Math.floor(Math.random() * genericResponses.length)];
    }
    
    // Manejar Enter en el input
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }
    
    // Pregunta r√°pida
    function quickQuestion(question) {
        document.getElementById('message-input').value = question;
        sendMessage();
    }
    
    // Limpiar chat
    function clearChat() {
        const chatMessages = document.getElementById('chat-messages');
        // Mantener solo el mensaje de bienvenida
        const welcomeMessage = chatMessages.firstElementChild;
        chatMessages.innerHTML = '';
        chatMessages.appendChild(welcomeMessage);
        messageCount = 0;
    }
    
    // Estado de carga
    function setLoading(loading) {
        const sendBtn = document.getElementById('send-btn');
        const input = document.getElementById('message-input');
        
        if (loading) {
            sendBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            sendBtn.disabled = true;
            input.disabled = true;
        } else {
            sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            sendBtn.disabled = false;
            input.disabled = false;
            input.focus();
        }
    }
    
    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('message-input').focus();
    });
</script>
{% endblock %}