{% extends "base.html" %}

{% block title %}Asistente de Cocina - Sistema Experto Culinario{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                <div class="card-body text-center py-5">
                    <h1 class="display-5 fw-bold mb-3">
                        <i class="fas fa-robot me-3"></i>
                        Asistente de Cocina Inteligente
                    </h1>
                    <p class="lead mb-0">
                        Tu chef personal con IA avanzada para t√©cnicas, recetas y consejos culinarios
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Chat Principal -->
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar bg-white text-success rounded-circle d-flex align-items-center justify-content-center" 
                                 style="width: 40px; height: 40px;">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0">Chef AI Master</h5>
                            <small class="opacity-75">
                                <span class="status-indicator"></span> Especialista en t√©cnicas culinarias
                            </small>
                        </div>
                        <div class="flex-shrink-0">
                            <button class="btn btn-outline-light btn-sm" onclick="clearChat()">
                                <i class="fas fa-broom"></i> Limpiar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- √Årea de chat -->
                <div class="card-body d-flex flex-column" style="height: 500px;">
                    <div id="chat-messages" class="flex-grow-1 overflow-auto mb-3">
                        <!-- Mensaje de bienvenida -->
                        <div class="message bot-message">
                            <div class="d-flex mb-3">
                                <div class="flex-shrink-0">
                                    <div class="avatar bg-success text-white rounded-circle d-flex align-items-center justify-content-center" 
                                         style="width: 35px; height: 35px;">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="bg-light rounded p-3">
                                        <p class="mb-2">¬°Hola! Soy tu Chef AI Master especializado en t√©cnicas culinarias. üë®‚Äçüç≥‚ú®</p>
                                        <p class="mb-0"><strong>Puedo ayudarte con:</strong></p>
                                        <ul class="mb-0 mt-2">
                                            <li><strong>T√©cnicas culinarias:</strong> sofrito, braseado, confitado, etc.</li>
                                            <li><strong>M√©todos de cocci√≥n:</strong> al vapor, en papillote, sous vide</li>
                                            <li><strong>Cortes de cuchillo:</strong> juliana, brunoise, chiffonade</li>
                                            <li><strong>Recomendaciones de recetas</strong> seg√∫n ingredientes</li>
                                            <li><strong>Informaci√≥n nutricional</strong> y sustitutos</li>
                                            <li><strong>Troubleshooting:</strong> c√≥mo arreglar errores en cocina</li>
                                        </ul>
                                        <p class="mt-2 mb-0"><em>üí° Preg√∫ntame espec√≠ficamente sobre cualquier t√©cnica o m√©todo!</em></p>
                                    </div>
                                    <small class="text-muted">Hace un momento</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input de mensaje -->
                    <div class="input-group">
                        <input type="text" 
                               id="message-input" 
                               class="form-control" 
                               placeholder="Ej: ¬øC√≥mo hacer un sofrito perfecto? ¬øQu√© es el braseado?"
                               onkeypress="handleKeyPress(event)">
                        <button class="btn btn-success" onclick="sendMessage()" id="send-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar con sugerencias -->
        <div class="col-lg-4">
            <!-- T√©cnicas Culinarias -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-fire text-danger me-2"></i>
                        T√©cnicas Culinarias
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øC√≥mo hacer un sofrito perfecto?')">
                            üßÑ ¬øC√≥mo hacer un sofrito perfecto?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øQu√© es el braseado y c√≥mo se hace?')">
                            üçñ ¬øQu√© es el braseado y c√≥mo se hace?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øC√≥mo hacer un roux para salsas?')">
                            ü•Ñ ¬øC√≥mo hacer un roux para salsas?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øCu√°les son los cortes b√°sicos de cuchillo?')">
                            üî™ Cortes b√°sicos de cuchillo
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øC√≥mo hacer una salsa madre bechamel?')">
                            ü•õ Salsa madre bechamel
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('¬øQu√© es el m√©todo en papillote?')">
                            üìÑ Cocci√≥n en papillote
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- M√©todos de Cocci√≥n -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-thermometer-half text-info me-2"></i>
                        M√©todos de Cocci√≥n
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-info btn-sm text-start" 
                                onclick="quickQuestion('¬øCu√°l es la diferencia entre hervir y pochar?')">
                            üíß Hervir vs Pochar
                        </button>
                        <button class="btn btn-outline-info btn-sm text-start" 
                                onclick="quickQuestion('¬øC√≥mo cocinar al vapor correctamente?')">
                            ‚ô®Ô∏è Cocci√≥n al vapor
                        </button>
                        <button class="btn btn-outline-info btn-sm text-start" 
                                onclick="quickQuestion('¬øQu√© temperaturas usar para asar?')">
                            üî• Temperaturas para asar
                        </button>
                        <button class="btn btn-outline-info btn-sm text-start" 
                                onclick="quickQuestion('¬øC√≥mo hacer un confitado perfecto?')">
                            ü¶Ü T√©cnica de confitado
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Troubleshooting -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-tools text-warning me-2"></i>
                        Soluci√≥n de Problemas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-warning btn-sm text-start" 
                                onclick="quickQuestion('Se me cort√≥ la mayonesa, ¬øc√≥mo la arreglo?')">
                            üò± Mayonesa cortada
                        </button>
                        <button class="btn btn-outline-warning btn-sm text-start" 
                                onclick="quickQuestion('Mi salsa est√° muy l√≠quida, ¬øc√≥mo la espeso?')">
                            üíß Espesar salsas
                        </button>
                        <button class="btn btn-outline-warning btn-sm text-start" 
                                onclick="quickQuestion('Se me quem√≥ la comida, ¬øpuedo salvarla?')">
                            üî• Comida quemada
                        </button>
                        <button class="btn btn-outline-warning btn-sm text-start" 
                                onclick="quickQuestion('La masa no levanta, ¬øqu√© hago?')">
                            üçû Problemas con masa
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Consejo del d√≠a -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-day text-info me-2"></i>
                        T√©cnica del D√≠a
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <i class="fas fa-cut fa-2x text-warning mb-3"></i>
                        <h6>Corte Brunoise</h6>
                        <p class="small text-muted mb-0">
                            Corte en dados de 1-2mm. Ideal para verduras arom√°ticas. 
                            T√©cnica: cortes paralelos ‚Üí perpendiculares ‚Üí transversales.
                        </p>
                        <button class="btn btn-outline-primary btn-sm mt-2" 
                                onclick="quickQuestion('¬øC√≥mo hacer el corte brunoise paso a paso?')">
                            Aprender t√©cnica
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Estado del asistente -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-graduation-cap text-info me-2"></i>
                        Chef AI Especializado
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center g-3">
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-brain fa-lg text-primary"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">IA Culinaria</small>
                                    <div class="small text-muted">Especializada</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-book-open fa-lg text-success"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">500+ T√©cnicas</small>
                                    <div class="small text-muted">Base de datos</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-chef-hat fa-lg text-warning"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">Chef Experto</small>
                                    <div class="small text-muted">Nivel Profesional</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-language fa-lg text-info"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">Espa√±ol</small>
                                    <div class="small text-muted">T√©cnico</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="alert alert-info py-2 mb-0" role="alert">
                        <small>
                            <i class="fas fa-lightbulb me-1"></i>
                            <strong>Tip:</strong> Soy especialista en t√©cnicas culinarias profesionales. 
                            Preg√∫ntame sobre m√©todos espec√≠ficos, cortes, cocciones y soluciones a problemas.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let messageCount = 0;
    
    // BASE DE CONOCIMIENTO CULINARIO EXPANDIDA
    const culinaryKnowledge = {
        // T√âCNICAS B√ÅSICAS
        'sofrito': {
            keywords: ['sofrito', 'sofreir', 'sofr√≠e', 'base arom√°tica'],
            response: `üßÑ <strong>SOFRITO PERFECTO:</strong><br><br>
                <strong>T√©cnica fundamental:</strong><br>
                1. <strong>Temperatura:</strong> Fuego medio-bajo<br>
                2. <strong>Aceite:</strong> Cubrir el fondo de la sart√©n<br>
                3. <strong>Orden:</strong> Cebolla ‚Üí Ajo ‚Üí Tomate<br>
                4. <strong>Tiempo:</strong> Cebolla transl√∫cida (5-7 min)<br>
                5. <strong>Ajo:</strong> Solo 30-60 segundos (no quemar)<br>
                6. <strong>Tomate:</strong> Hasta que pierda agua (3-4 min)<br><br>
                ‚ö†Ô∏è <strong>Error com√∫n:</strong> Fuego alto quema el ajo<br>
                ‚úÖ <strong>Secreto:</strong> Paciencia y fuego controlado`
        },
        
        'braseado': {
            keywords: ['braseado', 'brasear', 'braise'],
            response: `üçñ <strong>BRASEADO - T√âCNICA PROFESIONAL:</strong><br><br>
                <strong>Definici√≥n:</strong> Cocci√≥n mixta (seco + h√∫medo)<br><br>
                <strong>Proceso paso a paso:</strong><br>
                1. <strong>Sellado:</strong> Dorar la carne a fuego alto<br>
                2. <strong>Arom√°ticos:</strong> Agregar mirepoix (cebolla, zanahoria, apio)<br>
                3. <strong>Deglasar:</strong> Vino o caldo para soltar los sabores<br>
                4. <strong>L√≠quido:</strong> Cubrir 2/3 partes de la carne<br>
                5. <strong>Horno:</strong> 160¬∞C, cocci√≥n lenta 2-3 horas<br><br>
                üéØ <strong>Ideal para:</strong> Cortes duros con col√°geno<br>
                ü•© <strong>Carnes perfectas:</strong> Ossobuco, costillas, paleta`
        },
        
        'roux': {
            keywords: ['roux', 'espesar', 'harina mantequilla'],
            response: `ü•Ñ <strong>ROUX - BASE DE SALSAS:</strong><br><br>
                <strong>Proporci√≥n:</strong> 1:1 mantequilla y harina<br><br>
                <strong>Tipos por cocci√≥n:</strong><br>
                ‚Ä¢ <strong>Blanco:</strong> 2-3 min (salsas blancas)<br>
                ‚Ä¢ <strong>Rubio:</strong> 5-6 min (velout√©)<br>
                ‚Ä¢ <strong>Oscuro:</strong> 15-20 min (salsas oscuras)<br><br>
                <strong>T√©cnica:</strong><br>
                1. Derretir mantequilla a fuego medio<br>
                2. Agregar harina gradualmente<br>
                3. Cocinar sin parar de remover<br>
                4. Incorporar l√≠quido tibio de a poco<br><br>
                ‚ö†Ô∏è <strong>Error:</strong> Agregar l√≠quido fr√≠o causa grumos`
        },
        
        'cortes': {
            keywords: ['cortes', 'cuchillo', 'juliana', 'brunoise', 'chiffonade'],
            response: `üî™ <strong>CORTES B√ÅSICOS DE CUCHILLO:</strong><br><br>
                <strong>Cortes fundamentales:</strong><br>
                ‚Ä¢ <strong>Brunoise:</strong> Dados 1-2mm (aromat. finas)<br>
                ‚Ä¢ <strong>Juliana:</strong> Bastones 2mm x 5cm (guarnici√≥n)<br>
                ‚Ä¢ <strong>Chiffonade:</strong> Tiras finas de hojas<br>
                ‚Ä¢ <strong>Mirepoix:</strong> Dados irregulares 1cm<br>
                ‚Ä¢ <strong>Paisana:</strong> Dados regulares 1.5cm<br><br>
                <strong>T√©cnica segura:</strong><br>
                ‚úÖ Dedos curvados (garra)<br>
                ‚úÖ Cuchillo siempre perpendicular<br>
                ‚úÖ Movimiento basculante<br>
                ‚úÖ Tabla estable y antideslizante`
        },
        
        'bechamel': {
            keywords: ['bechamel', 'besamel', 'salsa madre', 'salsa blanca'],
            response: `ü•õ <strong>BECHAMEL - SALSA MADRE:</strong><br><br>
                <strong>Ingredientes base:</strong><br>
                ‚Ä¢ 40g mantequilla<br>
                ‚Ä¢ 40g harina<br>
                ‚Ä¢ 500ml leche tibia<br>
                ‚Ä¢ Nuez moscada, sal, pimienta<br><br>
                <strong>T√©cnica profesional:</strong><br>
                1. <strong>Roux blanco:</strong> Mantequilla + harina 3 min<br>
                2. <strong>Leche tibia:</strong> Incorporar de a poco<br>
                3. <strong>Batir constantemente</strong> evitar grumos<br>
                4. <strong>Cocinar 10-15 min</strong> hasta espesar<br>
                5. <strong>Condimentar</strong> al final<br><br>
                üìè <strong>Consistencia:</strong> Cubre la cuchara sin gotear<br>
                üéØ <strong>Usos:</strong> Lasa√±as, gratinados, croquetas`
        },
        
        'papillote': {
            keywords: ['papillote', 'papel', 'sobre', 'vapor'],
            response: `üìÑ <strong>COCCI√ìN EN PAPILLOTE:</strong><br><br>
                <strong>T√©cnica francesa:</strong> Cocci√≥n al vapor en sobre<br><br>
                <strong>Materiales:</strong><br>
                ‚Ä¢ Papel sulfurizado (pergamino)<br>
                ‚Ä¢ Papel aluminio (alternativa)<br><br>
                <strong>Proceso:</strong><br>
                1. <strong>Cortar papel</strong> en coraz√≥n grande<br>
                2. <strong>Aceitar ligeramente</strong> una mitad<br>
                3. <strong>Colocar alimento</strong> centrado<br>
                4. <strong>Agregar arom√°ticos</strong> (hierbas, vino)<br>
                5. <strong>Cerrar herm√©ticamente</strong> doblando bordes<br>
                6. <strong>Horno 180¬∞C</strong> 15-25 min seg√∫n grosor<br><br>
                üêü <strong>Perfecto para:</strong> Pescados, verduras, pollo<br>
                ‚ú® <strong>Ventaja:</strong> Conserva jugos y aromas`
        },
        
        'confitado': {
            keywords: ['confitado', 'confit', 'grasa', 'pato'],
            response: `ü¶Ü <strong>T√âCNICA CONFIT:</strong><br><br>
                <strong>Definici√≥n:</strong> Cocci√≥n lenta en grasa propia<br><br>
                <strong>Temperatura:</strong> 60-70¬∞C (muy baja)<br>
                <strong>Tiempo:</strong> 2-8 horas seg√∫n producto<br><br>
                <strong>Proceso para pato:</strong><br>
                1. <strong>Curado:</strong> Sal gruesa + hierbas 24h<br>
                2. <strong>Limpiar sal</strong> y secar bien<br>
                3. <strong>Sumergir en grasa</strong> de pato derretida<br>
                4. <strong>Horno 65¬∞C</strong> por 6-8 horas<br>
                5. <strong>Conservar en grasa</strong> hasta uso<br><br>
                ü•î <strong>Variante vegetal:</strong> Ajo confitado en aceite<br>
                üì¶ <strong>Conservaci√≥n:</strong> Meses en refrigeraci√≥n`
        }
    };
    
    // KNOWLEDGE BASE EXTENDIDA
    const extendedKnowledge = {
        // M√âTODOS DE COCCI√ìN
        'hervir': {
            keywords: ['hervir', 'hervido', 'ebullici√≥n', 'agua hirviendo'],
            response: `üíß <strong>HERVIR vs POCHAR:</strong><br><br>
                <strong>HERVIR (100¬∞C):</strong><br>
                ‚Ä¢ Burbujeo vigoroso constante<br>
                ‚Ä¢ Para: pasta, verduras duras, blanquear<br>
                ‚Ä¢ Tiempo: r√°pido pero puede arruinar textura<br><br>
                <strong>POCHAR (80-90¬∞C):</strong><br>
                ‚Ä¢ Burbujeo suave, casi sin movimiento<br>
                ‚Ä¢ Para: huevos, pescado delicado, frutas<br>
                ‚Ä¢ Resultado: textura sedosa y delicada<br><br>
                <strong>COCCI√ìN AL VAPOR:</strong><br>
                ‚Ä¢ Vaporera o colador sobre agua hirviendo<br>
                ‚Ä¢ Conserva nutrientes y sabores puros<br>
                ‚Ä¢ Tiempo: 20-30% m√°s que hervido`
        },
        
        'asar': {
            keywords: ['asar', 'horno', 'temperatura', 'asado'],
            response: `üî• <strong>TEMPERATURAS PARA ASAR:</strong><br><br>
                <strong>CARNES:</strong><br>
                ‚Ä¢ <strong>Aves:</strong> 180-200¬∞C (temp. interna 75¬∞C)<br>
                ‚Ä¢ <strong>Cerdo:</strong> 160-180¬∞C (temp. interna 70¬∞C)<br>
                ‚Ä¢ <strong>Cordero:</strong> 200¬∞C inicial ‚Üí 160¬∞C<br>
                ‚Ä¢ <strong>Res:</strong> 220¬∞C sellado ‚Üí 180¬∞C terminar<br><br>
                <strong>VERDURAS:</strong><br>
                ‚Ä¢ <strong>Ra√≠ces:</strong> 200¬∞C 30-45 min<br>
                ‚Ä¢ <strong>Calabazas:</strong> 180¬∞C 25-35 min<br>
                ‚Ä¢ <strong>Tomates:</strong> 150¬∞C 20-30 min<br><br>
                üå°Ô∏è <strong>Tip profesional:</strong> Term√≥metro de cocina<br>
                ‚è∞ <strong>Reposo:</strong> Carnes 5-10 min antes cortar`
        },
        
        // TROUBLESHOOTING
        'mayonesa': {
            keywords: ['mayonesa', 'cortada', 'cort√≥', 'arreglar'],
            response: `üò± <strong>REPARAR MAYONESA CORTADA:</strong><br><br>
                <strong>M√©todo de rescate:</strong><br>
                1. <strong>Bowl limpio</strong> + 1 yema nueva<br>
                2. <strong>Batir la yema</strong> hasta cremosa<br>
                3. <strong>Agregar mayo cortada</strong> gota a gota<br>
                4. <strong>Batir constantemente</strong> hasta emulsionar<br><br>
                <strong>Prevenci√≥n para la pr√≥xima:</strong><br>
                ‚úÖ Ingredientes a temperatura ambiente<br>
                ‚úÖ Aceite de a poco (hilo fino)<br>
                ‚úÖ Batir constantemente<br>
                ‚úÖ No m√°s de 200ml aceite por yema<br><br>
                ü•ö <strong>Alternativa:</strong> Usar batidora de inmersi√≥n`
        },
        
        'salsas': {
            keywords: ['salsa', 'l√≠quida', 'espesar', 'aguada'],
            response: `üíß <strong>ESPESAR SALSAS - M√âTODOS:</strong><br><br>
                <strong>ESPESANTES INSTANT√ÅNEOS:</strong><br>
                ‚Ä¢ <strong>Maicena:</strong> Disolver en agua fr√≠a primero<br>
                ‚Ä¢ <strong>Harina:</strong> Mezclar con mantequilla (beurre mani√©)<br>
                ‚Ä¢ <strong>Crema:</strong> Reduce y espesa naturalmente<br><br>
                <strong>M√âTODOS DE REDUCCI√ìN:</strong><br>
                ‚Ä¢ <strong>Fuego medio:</strong> Evaporar agua concentrando<br>
                ‚Ä¢ <strong>Sin tapa:</strong> Permitir evaporaci√≥n<br>
                ‚Ä¢ <strong>Tiempo:</strong> Paciencia para consistencia perfecta<br><br>
                <strong>ESPESANTES NATURALES:</strong><br>
                ‚Ä¢ <strong>Yemas:</strong> Templar y agregar al final<br>
                ‚Ä¢ <strong>Pur√© verduras:</strong> Licuar parte de la salsa`
        },
        
        'quemado': {
            keywords: ['quemado', 'quem√≥', 'negro', 'salvar'],
            response: `üî• <strong>RESCATAR COMIDA QUEMADA:</strong><br><br>
                <strong>EVALUACI√ìN INICIAL:</strong><br>
                üü° <strong>Ligeramente tostado:</strong> ¬°Se puede salvar!<br>
                üü§ <strong>Marr√≥n oscuro:</strong> Dif√≠cil pero posible<br>
                ‚ö´ <strong>Negro:</strong> Mejor empezar de nuevo<br><br>
                <strong>T√âCNICAS DE RESCATE:</strong><br>
                1. <strong>NO MEZCLAR</strong> - no incorporar lo quemado<br>
                2. <strong>Cambiar recipiente</strong> inmediatamente<br>
                3. <strong>Cortar papa cruda</strong> en rodajas (absorbe sabor)<br>
                4. <strong>Agregar dulce:</strong> Az√∫car/miel neutraliza<br>
                5. <strong>Diluir:</strong> Caldo o agua para reducir intensidad<br><br>
                ‚òï <strong>Para arroces:</strong> Pan tostado encima absorbe olor`
        },
        
        'masa': {
            keywords: ['masa', 'levadura', 'no levanta', 'pan'],
            response: `üçû <strong>MASA QUE NO LEVANTA:</strong><br><br>
                <strong>DIAGN√ìSTICO:</strong><br>
                ‚ùå <strong>Levadura muerta:</strong> Agua muy caliente (+40¬∞C)<br>
                ‚ùå <strong>Ambiente fr√≠o:</strong> Menos de 20¬∞C<br>
                ‚ùå <strong>Sal directa:</strong> Mata la levadura<br>
                ‚ùå <strong>Poca az√∫car:</strong> Levadura necesita alimento<br><br>
                <strong>SOLUCIONES:</strong><br>
                1. <strong>Test levadura:</strong> Agua tibia + az√∫car + levadura<br>
                2. <strong>Lugar c√°lido:</strong> Horno apagado con luz<br>
                3. <strong>M√°s tiempo:</strong> Doblar tiempo de levado<br>
                4. <strong>Agregar levadura:</strong> Nueva porci√≥n activada<br><br>
                üå°Ô∏è <strong>Temperatura ideal:</strong> 28-32¬∞C para levado`
        }
    };
    
    // Enviar mensaje
    function sendMessage() {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        
        if (!message) return;
        
        // Agregar mensaje del usuario
        addMessage('user', message);
        
        // Limpiar input y deshabilitar bot√≥n
        input.value = '';
        setLoading(true);
        
        // Simular respuesta del bot (m√°s r√°pido)
        setTimeout(() => {
            const response = generateAdvancedResponse(message);
            addMessage('bot', response);
            setLoading(false);
        }, 500 + Math.random() * 1000);
    }
    
    // Agregar mensaje al chat
    function addMessage(sender, content) {
        const chatMessages = document.getElementById('chat-messages');
        const isBot = sender === 'bot';
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isBot ? 'bot-message' : 'user-message'}`;
        
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        if (isBot) {
            messageDiv.innerHTML = `
                <div class="d-flex mb-3">
                    <div class="flex-shrink-0">
                        <div class="avatar bg-success text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 35px; height: 35px;">
                            <i class="fas fa-robot"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="bg-light rounded p-3">
                            ${content}
                        </div>
                        <small class="text-muted">${time}</small>
                    </div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="d-flex mb-3 justify-content-end">
                    <div class="flex-grow-1 me-3 text-end">
                        <div class="bg-primary text-white rounded p-3">
                            ${content}
                        </div>
                        <small class="text-muted">${time}</small>
                    </div>
                    <div class="flex-shrink-0">
                        <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 35px; height: 35px;">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            `;
        }
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        messageCount++;
    }
    
    // Generar respuesta avanzada del bot
    function generateAdvancedResponse(message) {
        const msg = message.toLowerCase();
        
        // Buscar en base de conocimiento principal
        for (const [key, data] of Object.entries(culinaryKnowledge)) {
            if (data.keywords.some(keyword => msg.includes(keyword))) {
                return data.response;
            }
        }
        
        // Buscar en base de conocimiento extendida
        for (const [key, data] of Object.entries(extendedKnowledge)) {
            if (data.keywords.some(keyword => msg.includes(keyword))) {
                return data.response;
            }
        }
        
        // RECETAS ESPEC√çFICAS
        if (msg.includes('receta') || msg.includes('cocinar')) {
            if (msg.includes('pollo') && msg.includes('arroz')) {
                return `üçó <strong>ARROZ CON POLLO PROFESIONAL:</strong><br><br>
                        <strong>T√©cnica del sofrito:</strong><br>
                        1. Sofrito perfecto: cebolla + ajo + pimiento<br>
                        2. Dorar pollo en piezas grandes<br>
                        3. Agregar tomate rallado<br>
                        4. Arroz bomba (absorbe mejor)<br>
                        5. Caldo caliente 3:1 con arroz<br>
                        6. Azafr√°n aut√©ntico en hebras<br>
                        7. NO remover una vez agregado el caldo<br><br>
                        ‚è∞ <strong>Cocci√≥n:</strong> 18-20 min fuego medio<br>
                        üî• <strong>Final:</strong> 2 min fuego alto para socarrat`;
            }
            
            if (msg.includes('pasta')) {
                return `üçù <strong>PASTA PERFECTA - T√âCNICA ITALIANA:</strong><br><br>
                        <strong>Regla 1-10-100:</strong><br>
                        ‚Ä¢ 1L agua por 100g pasta<br>
                        ‚Ä¢ 10g sal gruesa por litro<br>
                        ‚Ä¢ 100g pasta por persona<br><br>
                        <strong>Proceso profesional:</strong><br>
                        1. <strong>Agua hirviendo fuerte</strong> antes pasta<br>
                        2. <strong>Sal cuando hierva</strong> - agua debe saber salada<br>
                        3. <strong>Pasta de una vez</strong> - no romper espagueti<br>
                        4. <strong>Remover inicial</strong> evitar pegue<br>
                        5. <strong>Al dente:</strong> -1 min del paquete<br>
                        6. <strong>Agua de cocci√≥n</strong> para unir con salsa<br><br>
                        üßà <strong>Mantecatura:</strong> Pasta + salsa + agua pasta = cremosidad`;
            }
        }
        
        // T√âCNICAS ESPEC√çFICAS
        if (msg.includes('sellado') || msg.includes('sellar')) {
            return `üî• <strong>T√âCNICA DE SELLADO:</strong><br><br>
                    <strong>Objetivo:</strong> Reacci√≥n de Maillard = sabor<br><br>
                    <strong>T√©cnica correcta:</strong><br>
                    1. <strong>Sart√©n bien caliente</strong> - gota agua evapore instant√°neo<br>
                    2. <strong>Prote√≠na seca</strong> - secar con papel absorbente<br>
                    3. <strong>Aceite punto humo alto</strong> (girasol, canola)<br>
                    4. <strong>NO mover</strong> 2-3 min por lado<br>
                    5. <strong>Sonido siseo constante</strong> = temperatura correcta<br><br>
                    ‚ùå <strong>Mito:</strong> "Sellar sella jugos" es FALSO<br>
                    ‚úÖ <strong>Realidad:</strong> Sellado = sabor por Maillard`;
        }
        
        if (msg.includes('emulsi√≥n') || msg.includes('emulsionar')) {
            return `ü•Ñ <strong>EMULSIONES - CIENCIA CULINARIA:</strong><br><br>
                    <strong>Definici√≥n:</strong> Unir grasa + agua (inmiscibles)<br><br>
                    <strong>Emulsionantes naturales:</strong><br>
                    ‚Ä¢ <strong>Lecitina:</strong> Yemas de huevo<br>
                    ‚Ä¢ <strong>Prote√≠nas:</strong> Mostaza, miel<br>
                    ‚Ä¢ <strong>Almid√≥n:</strong> Harina, papa<br><br>
                    <strong>T√©cnica profesional:</strong><br>
                    1. <strong>Temperatura similar</strong> todos ingredientes<br>
                    2. <strong>Agregar grasa despacio</strong> (hilo fino)<br>
                    3. <strong>Batido constante</strong> crear fricci√≥n<br>
                    4. <strong>Mantener temperatura</strong> estable<br><br>
                    üß™ <strong>Ejemplos:</strong> Mayonesa, hollandaise, vinagreta`;
        }
        
        // INGREDIENTES Y SUSTITUTOS
        if (msg.includes('sustituir') || msg.includes('reemplazar')) {
            return `üîÑ <strong>SUSTITUTOS INTELIGENTES:</strong><br><br>
                    <strong>L√ÅCTEOS:</strong><br>
                    ‚Ä¢ Leche ‚Üí Leche vegetal 1:1<br>
                    ‚Ä¢ Mantequilla ‚Üí Aceite coco 3:4<br>
                    ‚Ä¢ Crema ‚Üí Leche evaporada + lim√≥n<br><br>
                    <strong>HUEVOS (cada uno):</strong><br>
                    ‚Ä¢ 1 tbsp linaza + 3 tbsp agua<br>
                    ‚Ä¢ 1/4 taza aquafaba<br>
                    ‚Ä¢ 1/4 taza pur√© manzana (postres)<br><br>
                    <strong>ESPESANTES:</strong><br>
                    ‚Ä¢ Harina ‚Üí Maicena 1:2<br>
                    ‚Ä¢ Crema ‚Üí Leche + roux<br><br>
                    üí° <strong>Tip:</strong> Cada sustituto cambia textura y sabor`;
        }
        
        // T√âRMINOS T√âCNICOS
        if (msg.includes('mirepoix')) {
            return `ü•ï <strong>MIREPOIX - BASE AROM√ÅTICA:</strong><br><br>
                    <strong>Proporci√≥n cl√°sica:</strong><br>
                    ‚Ä¢ 50% cebolla<br>
                    ‚Ä¢ 25% zanahoria<br>
                    ‚Ä¢ 25% apio<br><br>
                    <strong>Corte:</strong> Dados irregulares 1-1.5cm<br>
                    <strong>Uso:</strong> Base caldos, guisos, salsas<br>
                    <strong>Cocci√≥n:</strong> Sudar sin color 10-15 min<br><br>
                    üá´üá∑ <strong>Variantes:</strong><br>
                    ‚Ä¢ <strong>Matignon:</strong> + jam√≥n<br>
                    ‚Ä¢ <strong>Caj√∫n:</strong> Cebolla + apio + pimiento`;
        }
        
        if (msg.includes('bouquet garni')) {
            return `üåø <strong>BOUQUET GARNI:</strong><br><br>
                    <strong>Hierbas cl√°sicas:</strong><br>
                    ‚Ä¢ Tomillo fresco<br>
                    ‚Ä¢ Laurel<br>
                    ‚Ä¢ Perejil (tallos)<br>
                    ‚Ä¢ Apio (hojas)<br><br>
                    <strong>Preparaci√≥n:</strong><br>
                    1. Atar con hilo de cocina<br>
                    2. O envolver en gasa<br>
                    3. F√°cil retiro al final<br><br>
                    ‚è∞ <strong>Tiempo:</strong> √öltimo 30 min cocci√≥n<br>
                    üç≤ <strong>Uso:</strong> Caldos, estofados, braises`;
        }
        
        // RESPUESTAS MOTIVACIONALES
        const motivationalResponses = [
            `üë®‚Äçüç≥ <strong>¬°Excelente pregunta culinaria!</strong><br><br>
             Me especializo en t√©cnicas profesionales. Para darte la mejor respuesta, ¬øpodr√≠as ser m√°s espec√≠fico?<br><br>
             Por ejemplo:<br>
             ‚Ä¢ "¬øC√≥mo hacer un sofrito perfecto?"<br>
             ‚Ä¢ "¬øQu√© temperatura para asar pollo?"<br>
             ‚Ä¢ "¬øC√≥mo arreglar salsa cortada?"<br>
             ‚Ä¢ "¬øCu√°l es la t√©cnica del braseado?"<br><br>
             üéØ <strong>Soy experto en:</strong> T√©cnicas, m√©todos, troubleshooting y ciencia culinaria`,
            
            `üîß <strong>Chef AI a tu servicio</strong><br><br>
             Para ayudarte mejor, necesito m√°s detalles espec√≠ficos sobre:<br><br>
             üî• <strong>T√©cnicas:</strong> sofrito, braseado, confitado<br>
             üî™ <strong>Cortes:</strong> brunoise, juliana, chiffonade<br>
             üç≥ <strong>M√©todos:</strong> sellado, emulsi√≥n, reducci√≥n<br>
             ‚ö†Ô∏è <strong>Problemas:</strong> salsas cortadas, masa que no levanta<br><br>
             üí¨ <strong>Ejemplo:</strong> "Mi mayonesa se cort√≥, ¬øc√≥mo la arreglo?"`,
            
            `üéì <strong>Profesor de t√©cnicas culinarias</strong><br><br>
             Mi especialidad son los fundamentos t√©cnicos de la cocina profesional.<br><br>
             üìö <strong>Puedo ense√±arte:</strong><br>
             ‚Ä¢ M√©todos de cocci√≥n cient√≠ficos<br>
             ‚Ä¢ T√©cnicas de preparaci√≥n francesas<br>
             ‚Ä¢ Soluci√≥n de problemas culinarios<br>
             ‚Ä¢ Ciencia detr√°s de cada proceso<br><br>
             ü§î <strong>¬øQu√© t√©cnica espec√≠fica te interesa dominar?</strong>`
        ];
        
        return motivationalResponses[Math.floor(Math.random() * motivationalResponses.length)];
    }
    
    // Manejar Enter en el input
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }
    
    // Pregunta r√°pida
    function quickQuestion(question) {
        document.getElementById('message-input').value = question;
        sendMessage();
    }
    
    // Limpiar chat
    function clearChat() {
        const chatMessages = document.getElementById('chat-messages');
        // Mantener solo el mensaje de bienvenida
        const welcomeMessage = chatMessages.firstElementChild;
        chatMessages.innerHTML = '';
        chatMessages.appendChild(welcomeMessage);
        messageCount = 0;
    }
    
    // Estado de carga
    function setLoading(loading) {
        const sendBtn = document.getElementById('send-btn');
        const input = document.getElementById('message-input');
        
        if (loading) {
            sendBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            sendBtn.disabled = true;
            input.disabled = true;
        } else {
            sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            sendBtn.disabled = false;
            input.disabled = false;
            input.focus();
        }
    }
    
    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('message-input').focus();
        
        // Mostrar mensaje de bienvenida con t√©cnicas
        setTimeout(() => {
            addMessage('bot', `
                <strong>üí° EJEMPLOS DE PREGUNTAS ESPEC√çFICAS:</strong><br><br>
                üî• "¬øC√≥mo hacer un sofrito perfecto?"<br>
                ü•© "¬øQu√© es el braseado paso a paso?"<br>
                üî™ "¬øCu√°les son los cortes b√°sicos de cuchillo?"<br>
                üçù "¬øC√≥mo emulsionar una salsa correctamente?"<br>
                üò± "Se me cort√≥ la mayonesa, ¬øc√≥mo la arreglo?"<br>
                üå°Ô∏è "¬øQu√© temperaturas usar para asar carne?"<br><br>
                <em>¬°Preg√∫ntame cualquier t√©cnica culinaria espec√≠fica!</em>
            `);
        }, 2000);
    });
</script>
{% endblock %}