{% extends "base.html" %}

{% block title %}Asistente de Cocina - Sistema Experto Culinario{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                <div class="card-body text-center py-5">
                    <h1 class="display-5 fw-bold mb-3">
                        <i class="fas fa-robot me-3"></i>
                        Asistente de Cocina Inteligente
                    </h1>
                    <p class="lead mb-0">
                        Tu chef personal con inteligencia artificial estÃ¡ aquÃ­ para ayudarte
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Chat Principal -->
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar bg-white text-success rounded-circle d-flex align-items-center justify-content-center" 
                                 style="width: 40px; height: 40px;">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0">Chef AI Assistant</h5>
                            <small class="opacity-75">
                                <span class="status-indicator"></span> En lÃ­nea
                            </small>
                        </div>
                        <div class="flex-shrink-0">
                            <button class="btn btn-outline-light btn-sm" onclick="clearChat()">
                                <i class="fas fa-broom"></i> Limpiar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Ãrea de chat -->
                <div class="card-body d-flex flex-column" style="height: 500px;">
                    <div id="chat-messages" class="flex-grow-1 overflow-auto mb-3">
                        <!-- Mensaje de bienvenida -->
                        <div class="message bot-message">
                            <div class="d-flex mb-3">
                                <div class="flex-shrink-0">
                                    <div class="avatar bg-success text-white rounded-circle d-flex align-items-center justify-content-center" 
                                         style="width: 35px; height: 35px;">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="bg-light rounded p-3">
                                        <p class="mb-2">Â¡Hola! Soy tu asistente culinario inteligente. ğŸ³</p>
                                        <p class="mb-0">Puedo ayudarte con:</p>
                                        <ul class="mb-0 mt-2">
                                            <li>Sugerencias de recetas</li>
                                            <li>Consejos de cocina</li>
                                            <li>InformaciÃ³n nutricional</li>
                                            <li>Sustitutos de ingredientes</li>
                                            <li>TÃ©cnicas culinarias</li>
                                        </ul>
                                    </div>
                                    <small class="text-muted">Hace un momento</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input de mensaje -->
                    <div class="input-group">
                        <input type="text" 
                               id="message-input" 
                               class="form-control" 
                               placeholder="Escribe tu pregunta culinaria aquÃ­..."
                               onkeypress="handleKeyPress(event)">
                        <button class="btn btn-success" onclick="sendMessage()" id="send-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar con sugerencias -->
        <div class="col-lg-4">
            <!-- Sugerencias rÃ¡pidas -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Preguntas Frecuentes
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('Â¿QuÃ© puedo cocinar con pollo y arroz?')">
                            ğŸ— Â¿QuÃ© puedo cocinar con pollo y arroz?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('Â¿CÃ³mo sustituir huevos en una receta vegana?')">
                            ğŸ¥š Â¿CÃ³mo sustituir huevos en recetas veganas?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('Â¿CuÃ¡nto tiempo cocinar pasta al dente?')">
                            ğŸ Â¿CuÃ¡nto tiempo cocinar pasta al dente?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('Â¿CÃ³mo hacer que mi comida sea mÃ¡s saludable?')">
                            ğŸ¥— Â¿CÃ³mo hacer comida mÃ¡s saludable?
                        </button>
                        <button class="btn btn-outline-primary btn-sm text-start" 
                                onclick="quickQuestion('Â¿QuÃ© especias van bien con el pollo?')">
                            ğŸŒ¶ï¸ Â¿QuÃ© especias van bien con el pollo?
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Consejos del dÃ­a -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-day text-info me-2"></i>
                        Consejo del DÃ­a
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <i class="fas fa-thermometer-half fa-2x text-warning mb-3"></i>
                        <h6>Temperatura Perfecta</h6>
                        <p class="small text-muted mb-0">
                            Para obtener el mejor sabor en carnes, usa un termÃ³metro: 
                            pollo 75Â°C, carne de res 60Â°C para tÃ©rmino medio.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Recetas sugeridas -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-star text-warning me-2"></i>
                        Recetas Populares
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item border-0 px-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Pasta Carbonara</h6>
                                    <small class="text-muted">â­ 4.8 â€¢ 25 min</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" 
                                        onclick="quickQuestion('Â¿CÃ³mo hacer pasta carbonara perfecta?')">
                                    Preguntar
                                </button>
                            </div>
                        </div>
                        <div class="list-group-item border-0 px-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Pollo al Curry</h6>
                                    <small class="text-muted">â­ 4.6 â€¢ 35 min</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" 
                                        onclick="quickQuestion('Â¿CuÃ¡les son los secretos del curry?')">
                                    Preguntar
                                </button>
                            </div>
                        </div>
                        <div class="list-group-item border-0 px-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Ensalada CÃ©sar</h6>
                                    <small class="text-muted">â­ 4.5 â€¢ 15 min</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" 
                                        onclick="quickQuestion('Â¿CÃ³mo hacer aderezo cÃ©sar casero?')">
                                    Preguntar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Estado del asistente -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle text-info me-2"></i>
                        Sobre el Asistente
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center g-3">
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-brain fa-lg text-primary"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">IA Avanzada</small>
                                    <div class="small text-muted">Procesamiento NLP</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-database fa-lg text-success"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">1000+ Recetas</small>
                                    <div class="small text-muted">Base de datos</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-clock fa-lg text-warning"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">24/7</small>
                                    <div class="small text-muted">Disponible</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-light rounded p-2">
                                <i class="fas fa-language fa-lg text-info"></i>
                                <div class="mt-1">
                                    <small class="fw-bold">EspaÃ±ol</small>
                                    <div class="small text-muted">Nativo</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="alert alert-info py-2 mb-0" role="alert">
                        <small>
                            <i class="fas fa-magic me-1"></i>
                            <strong>Tip:</strong> Puedes preguntarme sobre tÃ©cnicas culinarias, 
                            sustitutos de ingredientes, tiempos de cocciÃ³n y mucho mÃ¡s.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let messageCount = 0;
    
    // Enviar mensaje
    function sendMessage() {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        
        if (!message) return;
        
        // Agregar mensaje del usuario
        addMessage('user', message);
        
        // Limpiar input y deshabilitar botÃ³n
        input.value = '';
        setLoading(true);
        
        // Simular respuesta del bot (en producciÃ³n serÃ­a una llamada AJAX)
        setTimeout(() => {
            const response = generateResponse(message);
            addMessage('bot', response);
            setLoading(false);
        }, 1000 + Math.random() * 2000);
    }
    
    // Agregar mensaje al chat
    function addMessage(sender, content) {
        const chatMessages = document.getElementById('chat-messages');
        const isBot = sender === 'bot';
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isBot ? 'bot-message' : 'user-message'}`;
        
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        if (isBot) {
            messageDiv.innerHTML = `
                <div class="d-flex mb-3">
                    <div class="flex-shrink-0">
                        <div class="avatar bg-success text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 35px; height: 35px;">
                            <i class="fas fa-robot"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="bg-light rounded p-3">
                            ${content}
                        </div>
                        <small class="text-muted">${time}</small>
                    </div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="d-flex mb-3 justify-content-end">
                    <div class="flex-grow-1 me-3 text-end">
                        <div class="bg-primary text-white rounded p-3">
                            ${content}
                        </div>
                        <small class="text-muted">${time}</small>
                    </div>
                    <div class="flex-shrink-0">
                        <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 35px; height: 35px;">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            `;
        }
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        messageCount++;
    }
    
    // Generar respuesta simulada del bot
    function generateResponse(message) {
        const msg = message.toLowerCase();
        
        // Respuestas predefinidas basadas en palabras clave
        if (msg.includes('pollo') && msg.includes('arroz')) {
            return `ğŸ— Â¡Excelente combinaciÃ³n! Te sugiero:<br><br>
                    <strong>Arroz con Pollo ClÃ¡sico:</strong><br>
                    â€¢ SofrÃ­e el pollo con ajo y cebolla<br>
                    â€¢ Agrega arroz y caldo de pollo<br>
                    â€¢ Cocina 18-20 minutos a fuego medio<br>
                    â€¢ AÃ±ade verduras para mÃ¡s color y nutriciÃ³n<br><br>
                    ğŸ’¡ <em>Tip:</em> Usa azafrÃ¡n para dar color dorado y sabor especial.`;
        }
        
        if (msg.includes('huevo') && (msg.includes('vegano') || msg.includes('sustituir'))) {
            return `ğŸ¥šâ¡ï¸ğŸŒ± Sustitutos veganos para huevos:<br><br>
                    <strong>Para hornear:</strong><br>
                    â€¢ 1 tbsp linaza molida + 3 tbsp agua (reposar 5 min)<br>
                    â€¢ 1/4 taza aquafaba (lÃ­quido de garbanzos)<br>
                    â€¢ 1/4 taza purÃ© de manzana<br><br>
                    <strong>Para ligar:</strong><br>
                    â€¢ Harina de garbanzo + agua<br>
                    â€¢ Tofu suave desmenuzado<br><br>
                    âœ¨ <em>Cada sustituto tiene propiedades diferentes!</em>`;
        }
        
        if (msg.includes('pasta') && msg.includes('dente')) {
            return `ğŸ Pasta al dente perfecta:<br><br>
                    <strong>Regla general:</strong> Tiempo del paquete - 1 minuto<br><br>
                    <strong>Pasos:</strong><br>
                    1. Agua hirviendo con sal abundante<br>
                    2. Agregar pasta cuando burbujee fuerte<br>
                    3. Revolver ocasionalmente<br>
                    4. Probar 1-2 min antes del tiempo indicado<br>
                    5. Debe quedar firme al morder<br><br>
                    ğŸ§‚ <em>Tip:</em> El agua debe saber a "mar" de sal.`;
        }
        
        if (msg.includes('saludable') || msg.includes('salud')) {
            return `ğŸ¥— Consejos para cocina saludable:<br><br>
                    <strong>TÃ©cnicas:</strong><br>
                    â€¢ Cocinar al vapor, hornear o plancha<br>
                    â€¢ Reducir sal, usar especias y hierbas<br>
                    â€¢ Incluir verduras de colores variados<br><br>
                    <strong>Ingredientes:</strong><br>
                    â€¢ Granos integrales en lugar de refinados<br>
                    â€¢ ProteÃ­nas magras (pescado, pollo sin piel)<br>
                    â€¢ Grasas buenas (aceite oliva, aguacate)<br><br>
                    ğŸ’š <em>Recuerda:</em> Balance y variedad son clave.`;
        }
        
        if (msg.includes('especias') && msg.includes('pollo')) {
            return `ğŸŒ¶ï¸ Especias perfectas para pollo:<br><br>
                    <strong>ClÃ¡sicas:</strong><br>
                    â€¢ PimentÃ³n, orÃ©gano, tomillo<br>
                    â€¢ Ajo en polvo, cebolla en polvo<br><br>
                    <strong>Internacionales:</strong><br>
                    â€¢ Curry (india) â€¢ Cinco especias (china)<br>
                    â€¢ Hierbas de Provenza (francesa)<br>
                    â€¢ CajÃºn (estadounidense)<br><br>
                    <strong>Marinad bÃ¡sico:</strong><br>
                    Aceite + limÃ³n + ajo + especias elegidas<br><br>
                    â° <em>Marina al menos 30 minutos.</em>`;
        }
        
        if (msg.includes('carbonara')) {
            return `ğŸ Carbonara autÃ©ntica italiana:<br><br>
                    <strong>Ingredientes (4 personas):</strong><br>
                    â€¢ 400g espagueti â€¢ 4 huevos (solo yemas)<br>
                    â€¢ 150g panceta â€¢ 100g queso Pecorino Romano<br>
                    â€¢ Pimienta negra reciÃ©n molida<br><br>
                    <strong>Secreto:</strong><br>
                    âŒ NO lleva nata ni ajo<br>
                    âœ… El cremoso viene de los huevos y queso<br>
                    ğŸ”¥ Mezclar fuera del fuego para no cuajar<br><br>
                    ğŸ‡®ğŸ‡¹ <em>Â¡Receta tradicional romana!</em>`;
        }
        
        if (msg.includes('curry')) {
            return `ğŸ› Secretos del curry perfecto:<br><br>
                    <strong>Base aromÃ¡tica:</strong><br>
                    â€¢ SofreÃ­r cebolla hasta dorar<br>
                    â€¢ Agregar ajo y jengibre<br>
                    â€¢ Tostar especias 30 segundos<br><br>
                    <strong>Especias clave:</strong><br>
                    â€¢ CÃºrcuma, comino, cilantro molido<br>
                    â€¢ Garam masala, chile en polvo<br><br>
                    <strong>Tips:</strong><br>
                    ğŸ¥¥ Leche de coco al final<br>
                    ğŸ… Tomate para acidez<br>
                    â° CocciÃ³n lenta = mÃ¡s sabor<br><br>
                    ğŸŒ¶ï¸ <em>Ajusta picante al gusto.</em>`;
        }
        
        if (msg.includes('aderezo') && msg.includes('cÃ©sar')) {
            return `ğŸ¥— Aderezo CÃ©sar casero:<br><br>
                    <strong>Ingredientes:</strong><br>
                    â€¢ 2 yemas de huevo â€¢ 2 dientes ajo<br>
                    â€¢ 4 anchoas â€¢ Jugo 1 limÃ³n<br>
                    â€¢ 1/2 taza aceite oliva â€¢ Queso parmesano<br><br>
                    <strong>PreparaciÃ³n:</strong><br>
                    1. Machacar ajo y anchoas<br>
                    2. Batir yemas con limÃ³n<br>
                    3. Agregar aceite lentamente<br>
                    4. Incorporar queso y sazonar<br><br>
                    ğŸ§„ <em>El ajo crudo le da el toque autÃ©ntico.</em>`;
        }
        
        // Respuesta genÃ©rica si no hay coincidencias
        const genericResponses = [
            `ğŸ¤” Interesante pregunta sobre cocina. Te recomiendo ser mÃ¡s especÃ­fico para darte una respuesta detallada. <br><br>Â¿PodrÃ­as contarme mÃ¡s detalles? Por ejemplo:<br>â€¢ Â¿QuÃ© ingredientes tienes?<br>â€¢ Â¿QuÃ© tipo de cocina prefieres?<br>â€¢ Â¿Tienes alguna restricciÃ³n dietÃ©tica?`,
            
            `ğŸ‘¨â€ğŸ³ Como chef virtual, necesito mÃ¡s informaciÃ³n para ayudarte mejor. <br><br>Puedo asistirte con:<br>â€¢ Recetas especÃ­ficas<br>â€¢ TÃ©cnicas de cocina<br>â€¢ Sustitutos de ingredientes<br>â€¢ InformaciÃ³n nutricional<br><br>Â¿Sobre cuÃ¡l te gustarÃ­a saber?`,
            
            `ğŸ³ Â¡Me encanta hablar de cocina! Para darte la mejor respuesta, comparte conmigo:<br><br>â€¢ Â¿Es sobre una receta especÃ­fica?<br>â€¢ Â¿Necesitas consejos de tÃ©cnica?<br>â€¢ Â¿Buscas opciones saludables?<br>â€¢ Â¿Tienes ingredientes especÃ­ficos?<br><br>Â¡Estoy aquÃ­ para ayudarte!`
        ];
        
        return genericResponses[Math.floor(Math.random() * genericResponses.length)];
    }
    
    // Manejar Enter en el input
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }
    
    // Pregunta rÃ¡pida
    function quickQuestion(question) {
        document.getElementById('message-input').value = question;
        sendMessage();
    }
    
    // Limpiar chat
    function clearChat() {
        const chatMessages = document.getElementById('chat-messages');
        // Mantener solo el mensaje de bienvenida
        const welcomeMessage = chatMessages.firstElementChild;
        chatMessages.innerHTML = '';
        chatMessages.appendChild(welcomeMessage);
        messageCount = 0;
    }
    
    // Estado de carga
    function setLoading(loading) {
        const sendBtn = document.getElementById('send-btn');
        const input = document.getElementById('message-input');
        
        if (loading) {
            sendBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            sendBtn.disabled = true;
            input.disabled = true;
        } else {
            sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            sendBtn.disabled = false;
            input.disabled = false;
            input.focus();
        }
    }
    
    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('message-input').focus();
    });
</script>
{% endblock %}